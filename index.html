<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>1ねんせい かんじマスター</title>
    
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&display=swap" rel="stylesheet">

    <style>
        /* 全体の設定 */
        body {
            font-family: 'Mochiy Pop One', sans-serif; /* かわいいフォント適用 */
            background-color: #FFF3E0; /* やさしいオレンジ背景 */
            margin: 0;
            padding: 0;
            min-height: 100vh;
            color: #4E342E;
            overflow-x: hidden;
            touch-action: manipulation; /* ダブルタップズーム防止 */
        }

        /* 画面切り替えの仕組み */
        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .screen.active {
            display: flex;
            opacity: 1;
        }

        /* --- 1. タイトル画面 --- */
        #title-screen {
            background: linear-gradient(135deg, #FFCC80 0%, #FFAB91 100%);
        }

        .game-title {
            font-size: 3rem;
            color: #FFF;
            text-shadow: 3px 3px 0px #BF360C;
            text-align: center;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .start-btn {
            background-color: #FFF;
            color: #E65100;
            font-size: 1.5rem;
            padding: 15px 50px;
            border-radius: 50px;
            border: none;
            box-shadow: 0 6px 0px #E65100;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            margin-top: 30px;
        }

        .start-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0px #E65100;
        }

        /* --- 2. 一覧画面 --- */
        #list-screen {
            justify-content: flex-start; /* 上寄せ */
            padding-top: 40px;
        }

        .header-info {
            background: white;
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .star-display {
            font-size: 1.2rem;
            color: #F57F17;
        }

        .kanji-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(65px, 1fr));
            gap: 12px;
            width: 100%;
            max-width: 800px;
            padding-bottom: 50px;
        }

        .kanji-card {
            background: white;
            aspect-ratio: 1 / 1;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            box-shadow: 0 4px 0px #D7CCC8;
            position: relative;
            transition: transform 0.1s;
            border: 2px solid transparent;
        }

        .kanji-card:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0px #D7CCC8;
        }

        /* クリア済みのデザイン */
        .kanji-card.completed {
            background-color: #FFFDE7;
            border-color: #FFD700;
            color: #F57F17;
        }

        .kanji-card.completed::after {
            content: "★";
            position: absolute;
            top: -8px;
            right: -8px;
            font-size: 1.2rem;
            color: #FFD700;
            text-shadow: 1px 1px 0 #FFF;
        }

        /* --- 3. 練習画面 --- */
        #practice-screen {
            background-color: #E0F7FA;
        }

        .practice-header {
            width: 100%;
            max-width: 500px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .back-btn {
            background: #00838F;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-family: inherit;
        }

        .target-char-display {
            font-size: 2rem;
            color: #006064;
        }

        .canvas-container {
            background: white;
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 8px 0px #4DD0E1;
            margin-bottom: 20px;
            position: relative;
        }

        #character-target-div {
            width: 300px;
            height: 300px;
            /* スマホでの誤操作防止 */
            touch-action: none;
        }

        #message-area {
            height: 40px;
            font-size: 1.2rem;
            color: #006064;
            text-align: center;
            font-weight: bold;
        }

        /* アニメーション用 */
        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        .star-animation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10rem;
            color: #FFD700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            animation: pop 0.5s ease-out;
            pointer-events: none;
            display: none;
            z-index: 100;
        }

    </style>
</head>
<body>

    <div id="title-screen" class="screen active">
        <div class="game-title">1ねんせい<br>かんじ<br>マスター</div>
        <button class="start-btn" onclick="showScreen('list-screen')">スタート！</button>
    </div>

    <div id="list-screen" class="screen">
        <div class="header-info">
            <div>あつめた星： <span id="star-counter" style="font-size:1.5rem; font-weight:bold;">0</span> / 80</div>
        </div>
        <div class="kanji-grid" id="kanji-grid">
            </div>
        <button class="back-btn" onclick="resetData()" style="margin-top:20px; background:#B0BEC5; font-size:0.8rem;">データを消す</button>
    </div>

    <div id="practice-screen" class="screen">
        <div class="practice-header">
            <button class="back-btn" onclick="showScreen('list-screen')">もどる</button>
            <div id="current-reading" class="target-char-display">よみ</div>
            <div style="width: 60px;"></div> </div>

        <div class="canvas-container">
            <div id="character-target-div"></div>
            <div id="big-star" class="star-animation">★</div>
        </div>

        <div id="message-area">なぞってみよう！</div>

        <button class="back-btn" onclick="retry()" style="background:#FF7043; margin-top:10px;">書き直す</button>
    </div>

    <script>
        // --- データ設定 ---
        const kanjiData = [
            { char: '一', reading: 'いち' }, { char: '右', reading: 'みぎ' }, { char: '雨', reading: 'あめ' }, { char: '円', reading: 'えん' },
            { char: '王', reading: 'おう' }, { char: '音', reading: 'おと' }, { char: '下', reading: 'した' }, { char: '火', reading: 'ひ' },
            { char: '花', reading: 'はな' }, { char: '貝', reading: 'かい' }, { char: '学', reading: 'まなぶ' }, { char: '気', reading: 'き' },
            { char: '九', reading: 'きゅう' }, { char: '休', reading: 'やすむ' }, { char: '玉', reading: 'たま' }, { char: '金', reading: 'かね' },
            { char: '空', reading: 'そら' }, { char: '月', reading: 'つき' }, { char: '犬', reading: 'いぬ' }, { char: '見', reading: 'みる' },
            { char: '五', reading: 'ご' }, { char: '口', reading: 'くち' }, { char: '校', reading: 'こう' }, { char: '左', reading: 'ひだり' },
            { char: '三', reading: 'さん' }, { char: '山', reading: 'やま' }, { char: '子', reading: 'こ' }, { char: '四', reading: 'よん' },
            { char: '糸', reading: 'いと' }, { char: '字', reading: 'じ' }, { char: '耳', reading: 'みみ' }, { char: '七', reading: 'なな' },
            { char: '車', reading: 'くるま' }, { char: '手', reading: 'て' }, { char: '十', reading: 'じゅう' }, { char: '出', reading: 'でる' },
            { char: '女', reading: 'おんな' }, { char: '小', reading: 'ちいさい' }, { char: '上', reading: 'うえ' }, { char: '森', reading: 'もり' },
            { char: '人', reading: 'ひと' }, { char: '水', reading: 'みず' }, { char: '正', reading: 'ただしい' }, { char: '生', reading: 'いきる' },
            { char: '青', reading: 'あお' }, { char: '夕', reading: 'ゆう' }, { char: '石', reading: 'いし' }, { char: '赤', reading: 'あか' },
            { char: '千', reading: 'せん' }, { char: '川', reading: 'かわ' }, { char: '先', reading: 'さき' }, { char: '早', reading: 'はやい' },
            { char: '草', reading: 'くさ' }, { char: '足', reading: 'あし' }, { char: '村', reading: 'むら' }, { char: '大', reading: 'おおきい' },
            { char: '男', reading: 'おとこ' }, { char: '竹', reading: 'たけ' }, { char: '中', reading: 'なか' }, { char: '虫', reading: 'むし' },
            { char: '町', reading: 'まち' }, { char: '天', reading: 'てん' }, { char: '田', reading: 'た' }, { char: '土', reading: 'つち' },
            { char: '二', reading: 'に' }, { char: '日', reading: 'ひ' }, { char: '入', reading: 'はいる' }, { char: '年', reading: 'とし' },
            { char: '白', reading: 'しろ' }, { char: '八', reading: 'はち' }, { char: '百', reading: 'ひゃく' }, { char: '文', reading: 'ぶん' },
            { char: '木', reading: 'き' }, { char: '本', reading: 'ほん' }, { char: '名', reading: 'な' }, { char: '目', reading: 'め' },
            { char: '立', reading: 'たつ' }, { char: '力', reading: 'ちから' }, { char: '林', reading: 'はやし' }, { char: '六', reading: 'ろく' }
        ];

        // 状態管理
        let progress = JSON.parse(localStorage.getItem('kanjiMasterProgress')) || {};
        let writer;
        let currentChar = null;

        // --- 画面遷移 ---
        function showScreen(screenId) {
            // すべての画面を非表示
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            // 指定された画面を表示
            document.getElementById(screenId).classList.add('active');

            // 一覧画面を開くときはリストを更新
            if (screenId === 'list-screen') {
                renderList();
            }
        }

        // --- 一覧画面の描画 ---
        function renderList() {
            const grid = document.getElementById('kanji-grid');
            grid.innerHTML = '';
            let stars = 0;

            kanjiData.forEach(item => {
                const isCompleted = progress[item.char];
                if (isCompleted) stars++;

                const card = document.createElement('div');
                card.className = `kanji-card ${isCompleted ? 'completed' : ''}`;
                card.innerText = item.char;
                card.onclick = () => startPractice(item);

                grid.appendChild(card);
            });

            document.getElementById('star-counter').innerText = stars;
        }

        // --- 練習開始 ---
        function startPractice(item) {
            currentChar = item;
            showScreen('practice-screen');

            // UIリセット
            document.getElementById('current-reading').innerText = `${item.char} (${item.reading})`;
            document.getElementById('message-area').innerText = "じゅんばんに なぞろう！";
            document.getElementById('message-area').style.color = "#006064";
            document.getElementById('character-target-div').innerHTML = '';
            document.getElementById('big-star').style.display = 'none'; // 星を隠す

            // HanziWriter 初期化
            writer = HanziWriter.create('character-target-div', item.char, {
                width: 300,
                height: 300,
                padding: 10,
                showOutline: true,
                strokeAnimationSpeed: 1,
                delayBetweenStrokes: 200,
                radicalColor: '#168F16',
                drawingWidth: 25, // 子供用に少し太く
                outlineColor: '#DDD',
                strokeColor: '#333',
                highlightColor: '#FF7043',
            });

            startQuiz();
        }

        // --- クイズ（なぞり書き）ロジック ---
        function startQuiz() {
            writer.quiz({
                onMistake: function(strokeData) {
                    document.getElementById('message-area').innerText = "おしい！ここだよ！";
                    document.getElementById('message-area').style.color = "#D32F2F";
                    writer.animateStroke(strokeData.strokeNum); // ヒントを表示
                },
                onCorrectStroke: function(strokeData) {
                    document.getElementById('message-area').innerText = "いいね！";
                    document.getElementById('message-area').style.color = "#388E3C";
                },
                onComplete: function(summaryData) {
                    handleComplete();
                }
            });
        }

        // --- クリア時の処理 ---
        function handleComplete() {
            document.getElementById('message-area').innerText = "できたー！！";
            document.getElementById('message-area').style.color = "#F57F17";
            
            // データを保存
            progress[currentChar.char] = true;
            localStorage.setItem('kanjiMasterProgress', JSON.stringify(progress));

            // 派手な演出
            const bigStar = document.getElementById('big-star');
            bigStar.style.display = 'block';
            
            // 1.5秒後に一覧に戻る
            setTimeout(() => {
                showScreen('list-screen');
            }, 1500);
        }

        function retry() {
            startPractice(currentChar);
        }

        function resetData() {
            if (confirm("ほんとうに データを けしますか？")) {
                localStorage.removeItem('kanjiMasterProgress');
                progress = {};
                renderList();
            }
        }

        // --- 初期化 ---
        // 読み込み時は何もしない（HTMLでタイトル画面がactiveになっているため）

    </script>
</body>
</html>
